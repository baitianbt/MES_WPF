# **MES系统架构设计文档**
**版本：** V1.0
**日期：** 2023年10月28日
**适用对象：** 开发团队、IT实施人员、质量保证团队

---

## **一、系统总体架构**

### **1. 架构概览**

本MES系统采用WPF技术栈构建客户端应用程序，基于C#/.NET 8.0开发，采用MVVM架构模式。系统整体采用三层架构：

```
┌───────────────────────────────────┐
│            表现层 (UI)            │
│  ┌─────────────┐ ┌─────────────┐  │
│  │   View      │ │  ViewModel  │  │
│  └─────────────┘ └─────────────┘  │
├───────────────────────────────────┤
│            业务逻辑层             │
│  ┌─────────────┐ ┌─────────────┐  │
│  │  Services   │ │   Models    │  │
│  └─────────────┘ └─────────────┘  │
├───────────────────────────────────┤
│            数据访问层             │
│  ┌─────────────┐ ┌─────────────┐  │
│  │Repositories │ │Data Mappers │  │
│  └─────────────┘ └─────────────┘  │
└───────────────────────────────────┘
```

### **2. 技术选型**

- **客户端框架**：WPF (.NET 8.0)
- **设计模式**：MVVM (Model-View-ViewModel)
- **UI组件库**：Material
- **数据绑定**：CommunityTool.MVVM
- **依赖注入**:DI
- **ORM框架**：Entity Framework Core
- **日志框架**Serialog
- **图表组件**：LiveCharts
- **本地数据库**：SQLite (离线模式)

---

## **二、系统层次结构**

### **1. 表现层 (UI)**

- **Views**：XAML页面和用户控件
  - 主窗体 (MainWindow)
  - 各功能模块页面
  - 自定义控件库
  - 资源字典和样式模板

- **ViewModels**：
  - 页面导航逻辑
  - 数据验证逻辑

### **2. 业务逻辑层**

- **Services**：
  - 计划排程服务
  - 生产执行服务
  - 物料追溯服务
  - 质量管理服务
  - 设备监控服务
  - 绩效分析服务
  - 用户认证服务
  - 报表生成服务

- **Models**：
  - 业务实体模型
  - 业务规则验证
  - 工厂模型构建

### **3. 数据访问层**

- **Repositories**：
  - 实现仓储模式
  - 封装CRUD操作
  - 事务管理

- **Data Mappers**：
  - DTO转换器
  - 实体映射配置

- **集成接口**：
  - ERP数据接口
  - 设备OPC UA接口
  - 扫描设备接口

---

## **三、核心模块设计**

### **1. 生产计划与调度模块**

```
┌─────────────────────────────────────────┐
│         PlanningViewModel               │
├─────────────────────────────────────────┤
│ - 订单集合 (ObservableCollection)       │
│ - 资源集合 (Machines, Workers)          │
│ - 生产计划甘特图数据                     │
│ - 命令 (NewOrder, DeleteOrder等)        │
└───────────────┬─────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────┐
│         PlanningService                 │
├─────────────────────────────────────────┤
│ - 获取ERP订单()                         │
│ - 优化排程算法()                         │
│ - 计算资源负荷()                         │
│ - 生成作业指导书()                       │
└───────────────┬─────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────┐
│         PlanningRepository              │
├─────────────────────────────────────────┤
│ - 保存计划()                            │
│ - 获取历史计划()                         │
│ - 更新计划状态()                         │
└─────────────────────────────────────────┘
```

### **2. 生产过程执行模块**

- **工单管理**：电子工单创建、状态跟踪、工艺参数监控
- **报工功能**：实时报工、异常报告、返工管理
- **进度监控**：实时看板数据服务、产线状态监控
- **条码管理**：条码/RFID解析器、校验逻辑

### **3. 物料与追溯模块**

- **批次管理**：批次编码规则、批次状态管理
- **物料消耗**：实际用量vs标准BOM比对
- **追溯链服务**：正向/逆向追溯算法
- **库位管理**：电子货架状态同步

### **4. 质量管理模块**

- **检验计划**：自动触发机制、检验项配置
- **检验执行**：检验数据采集、合格判定
- **SPC分析**：统计过程控制算法、预警机制
- **质量追溯**：缺陷代码库、图片存储

### **5. 设备管理模块**

- **设备监控**：状态数据采集、实时显示
- **OEE计算**：效率指标算法
- **维修管理**：工单流转、备件管理

### **6. 绩效分析模块**

- **指标定义**：KPI计算模型
- **数据聚合**：多维度统计分析
- **报表服务**：模板引擎、导出功能

---

## **四、数据模型设计**

### **1. 核心数据实体**

```
┌───────────┐      ┌───────────┐      ┌───────────┐
│  订单     │───┬─▶│  工单     │──────▶│  工序     │
└───────────┘   │  └───────────┘      └───────────┘
                │        │                  │
                │        ▼                  ▼
┌───────────┐   │  ┌───────────┐      ┌───────────┐
│  产品     │◀──┘  │  物料     │      │  资源     │
└───────────┘      └───────────┘      └───────────┘
     │                  │                  │
     ▼                  ▼                  ▼
┌───────────┐      ┌───────────┐      ┌───────────┐
│  BOM      │      │  批次     │      │  设备     │
└───────────┘      └───────────┘      └───────────┘
                        │                  │
                        ▼                  ▼
                   ┌───────────┐      ┌───────────┐
                   │  质检     │      │  维保     │
                   └───────────┘      └───────────┘
```

### **2. 数据库设计**

- 采用关系型数据库 (SQL Server/Oracle)
- 支持分表策略处理大量历史数据
- 实现数据分区提升查询性能

---


---

## **六、UI设计规范**

### **1. 布局框架**

- **主框架**：Ribbon菜单 + 导航树 + 工作区
- **皮肤系统**：支持明/暗主题切换
- **响应式布局**：适应不同屏幕分辨率

### **2. 控件库**

- **数据网格**：高性能虚拟化DataGrid
- **甘特图**：自定义拖拽排程控件
- **仪表盘**：自定义指标卡片
- **图表库**：柱状图、折线图、饼图等

---

## **七、安全性设计**

### **1. 认证授权**

- **用户认证**：支持Windows认证/表单认证
- **权限管理**：基于角色的访问控制(RBAC)
- **操作审计**：关键操作日志记录

### **2. 数据安全**

- **敏感数据加密**：AES加密算法
- **数据脱敏**：个人信息显示脱敏
- **数据完整性**：事务完整性保障

---

## **八、部署策略**

### **1. 客户端部署**

- **ClickOnce部署**：支持自动更新
- **离线安装包**：MSI安装程序
- **配置管理**：外部化配置文件



### **3. 数据备份与恢复**

- **增量备份**：每日自动备份
- **全量备份**：每周执行
- **恢复机制**：支持时间点恢复

---

## **九、性能优化策略**

### **1. UI性能**

- **数据虚拟化**：大数据集分页加载
- **UI线程优化**：后台任务处理
- **内存管理**：大对象池管理

### **2. 数据访问优化**

- **缓存策略**：多级缓存机制
- **查询优化**：索引设计与查询计划优化
- **批处理**：批量操作减少数据库往返

---

